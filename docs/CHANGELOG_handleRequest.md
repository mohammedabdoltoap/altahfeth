# ุณุฌู ุงูุชุบููุฑุงุช - ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู handleRequest

## ุงูุชุงุฑูุฎ: 25 ุฃูุชูุจุฑ 2025

## ููุฎุต ุงูุชุญุฏูุซ
ุชู ุชุญุณูู ุฏุงูุฉ `handleRequest` ูุชูููุฑ ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก ูู ุฌููุน ุฃูุญุงุก ุงูุชุทุจูู.

---

## ๐ฏ ุงููุดููุฉ

ุนูุฏ ุญุฏูุซ ุฎุทุฃ ูู ุงูุฎุงุฏู ุฃู ุงูุดุจูุฉุ ูุงูุช ุฏุงูุฉ `handleRequest` ุชุฑุฌุน `null`ุ ููุง ูุณุจุจ:
- ุตุนูุจุฉ ูู ุงูุชูููุฒ ุจูู ุฃููุงุน ุงูุฃุฎุทุงุก ุงููุฎุชููุฉ
- ุนุฏู ูุถูุญ ุณุจุจ ุงููุดู ูููุณุชุฎุฏู
- ุตุนูุจุฉ ูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ููุญุฏ ูู ุฌููุน ุงูุตูุญุงุช

### ูุซุงู ุนูู ุงููุดููุฉ:
```dart
final response = await handleRequest(...);

if (response == null) return; // โ ูุง ูุนุฑู ููุงุฐุง null
// ูู ูู ุฎุทุฃ ุดุจูุฉุ ุฎุทุฃ ุฎุงุฏูุ timeoutุ
```

---

## โ ุงูุญู

ุชู ุฅุถุงูุฉ ูุนุงูู ุฌุฏูุฏ `returnErrorResponse` ุฅูู ุฏุงูุฉ `handleRequest`:

```dart
Future<T?> handleRequest<T>({
  required RxBool isLoading,
  required Future<T> Function() action,
  String loadingMessage = "ุฌุงุฑู ุงููุนุงูุฌุฉ...",
  String defaultErrorTitle = "ุฎุทุฃ",
  bool useDialog = true,
  bool immediateLoading = false,
  bool returnErrorResponse = false, // โจ ุฌุฏูุฏ
})
```

---

## ๐ง ุงูุชุนุฏููุงุช ุงูุชูุตูููุฉ

### 1. ุชุนุฏูู `handleRequest` ูู `lib/constants/function.dart`

#### ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:
- โ ุฅุฑุฌุงุน ุงุณุชุฌุงุจุฉ ููุญุฏุฉ ุจุฏูุงู ูู `null` ุนูุฏ ุงูุฃุฎุทุงุก
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุตูุฉ
- โ ุงูุชูุงูู ุงููุงูู ูุน ุงูููุฏ ุงููุฏูู (ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ `false`)

#### ุฃููุงุน ุงูุฃุฎุทุงุก ุงููุฏุนููุฉ:
1. **ุฎุทุฃ ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช**
   ```dart
   {"stat": "error", "msg": "ูุง ููุฌุฏ ุงุชุตุงู ุจุงูุฅูุชุฑูุช"}
   ```

2. **ุงูุชูุงุก ูููุฉ ุงูุงุชุตุงู (Timeout)**
   ```dart
   {"stat": "error", "msg": "ุงูุชูุช ูููุฉ ุงูุงุชุตุงู. ุชุญูู ูู ุงูุฅูุชุฑูุช ูุญุงูู ูุฑุฉ ุฃุฎุฑู"}
   ```

3. **ูุดู ุงูุงุชุตุงู ุจุงูุฎุงุฏู (SocketException)**
   ```dart
   {"stat": "error", "msg": "ูุดู ุงูุงุชุตุงู ุจุงูุฎุงุฏู. ุชุญูู ูู ุงูุฅูุชุฑูุช"}
   ```

4. **ุฎุทุฃ ูู ุชูุณูู ุงูุจูุงูุงุช (FormatException)**
   ```dart
   {"stat": "error", "msg": "ุฎุทุฃ ูู ุชูุณูู ุงูุจูุงูุงุช ุงููุณุชููุฉ"}
   ```

5. **ุฎุทุฃ ูู ุงูุงุชุตุงู ุงูุขูู (HandshakeException)**
   ```dart
   {"stat": "error", "msg": "ุฎุทุฃ ูู ุงูุงุชุตุงู ุงูุขูู ุจุงูุฎุงุฏู"}
   ```

6. **ุฃุฎุทุงุก ุบูุฑ ูุชููุนุฉ**
   ```dart
   {"stat": "error", "msg": "ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุน ุฃุซูุงุก ุงูุนูููุฉ"}
   ```

### 2. ุชุญุฏูุซ `loginController` ูู `lib/controller/loginController.dart`

#### ุงูุชุนุฏููุงุช:
- โ ุชูุนูู `returnErrorResponse: true` ูู `select_data_user()`
- โ ุชูุนูู `returnErrorResponse: true` ูู `select_data_Student()`
- โ ุฅุถุงูุฉ ูุนุงูุฌุฉ ุฎุงุตุฉ ูุญุงูุฉ `stat == "error"`
- โ ุฑุณุงุฆู ุฎุทุฃ ุฃูุซุฑ ูุถูุญุงู ูููุณุชุฎุฏู

#### ูุจู ุงูุชุนุฏูู:
```dart
final response = await handleRequest<dynamic>(...);

if (response == null) return; // โ ุฎุฑูุฌ ุตุงูุช
if (response is! Map) {
  mySnackbar("ุฎุทุฃ", "ูุดู ุงูุงุชุตุงู ุจุงูุฎุงุฏู");
  return;
}
```

#### ุจุนุฏ ุงูุชุนุฏูู:
```dart
final response = await handleRequest<dynamic>(
  returnErrorResponse: true, // โจ ุฌุฏูุฏ
  ...
);

if (response == null || response is! Map) {
  mySnackbar("ุฎุทุฃ", "ูุดู ุงูุงุชุตุงู ุจุงูุฎุงุฏู");
  return;
}

if (response["stat"] == "ok") {
  // ูุนุงูุฌุฉ ุงููุฌุงุญ
} else if (response["stat"] == "error") {
  // โจ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุงูุฎุงุฏู/ุงูุดุจูุฉ
  String errorMsg = response["msg"] ?? "ุญุฏุซ ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู";
  mySnackbar("ุฎุทุฃ", errorMsg);
} else {
  // ูุนุงูุฌุฉ ุฃุฎุทุงุก ุชุณุฌูู ุงูุฏุฎูู
  String errorMsg = response["msg"] ?? "ุงุณู ุงููุณุชุฎุฏู ุฃู ูููุฉ ุงููุฑูุฑ ุฎุงุทุฆุฉ";
  mySnackbar("ุฎุทุฃ", errorMsg);
}
```

---

## ๐ ุงูููุงุฆุฏ

### 1. ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ููููููุฉ
- โ ุงููุณุชุฎุฏู ูุนุฑู ุจุงูุถุจุท ูุง ุงููุดููุฉ
- โ ุชูุฌููุงุช ูุงุถุญุฉ ูุญู ุงููุดููุฉ

### 2. ููุฏ ุฃูุธู ูุฃุณูู ูู ุงูุตูุงูุฉ
- โ ูุนุงูุฌุฉ ููุญุฏุฉ ููุฃุฎุทุงุก ูู ุฌููุน ุงูุตูุญุงุช
- โ ุชูููู ุงูุชูุฑุงุฑ ูู ุงูููุฏ
- โ ุณูููุฉ ุฅุถุงูุฉ ูุนุงูุฌุงุช ุฌุฏูุฏุฉ ููุฃุฎุทุงุก

### 3. ุชุตุญูุญ ุฃุณูู (Debugging)
- โ ุฑุณุงุฆู ุฎุทุฃ ููุตูุฉ ูู Console
- โ ุชุชุจุน ุฃูุถู ููุตุฏุฑ ุงูุฎุทุฃ
- โ ูุนูููุงุช ูุงููุฉ ูุญู ุงููุดุงูู

---

## ๐ ุงูุชุทุจูู ุนูู ุจููุฉ ุงููุดุฑูุน

### ุงูุตูุญุงุช ุฐุงุช ุงูุฃููููุฉ ุงูุนุงููุฉ:
1. โ **ุตูุญุงุช ุชุณุฌูู ุงูุฏุฎูู** (ุชู ุงูุชุทุจูู)
2. ๐ **ุตูุญุงุช ุงูุชูุงุฑูุฑ** (ููุตู ุจู)
   - TeacherPerformanceReport
   - DailyRecitationReport
   - LeaveRequestsReport
   - ResignationRequestsReport
   - StudentAttendanceReport
   - TeacherAttendanceReport

3. ๐ **ุตูุญุงุช ุงูุญุถูุฑ ูุงูุบูุงุจ** (ููุตู ุจู)
   - AttendanceController
   - User_AttendanceController
   - UpdateAttendanceController

4. ๐ **ุตูุญุงุช ุฅุฏุงุฑุฉ ุงูุทูุงุจ** (ููุตู ุจู)
   - addstudentController
   - update_StudentController
   - StudentPageController

5. ๐ **ุตูุญุงุช ุงูุชุณููุน ูุงููุฑุงุฌุนุฉ** (ููุตู ุจู)
   - daily_reportController
   - ReviewController
   - Update_Daily_ReportController
   - Update_ReviewController

---

## ๐ ููููุฉ ุงูุชุทุจูู ุนูู ุตูุญุฉ ุฌุฏูุฏุฉ

### ุงูุฎุทูุงุช:
1. ุงูุชุญ Controller ุงูุฎุงุต ุจุงูุตูุญุฉ
2. ุงุจุญุซ ุนู ุงุณุชุฏุนุงุกุงุช `handleRequest`
3. ุฃุถู `returnErrorResponse: true`
4. ุฃุถู ูุนุงูุฌุฉ ูุญุงูุฉ `stat == "error"`

### ูุซุงู:
```dart
Future<void> loadData() async {
  final response = await handleRequest<dynamic>(
    isLoading: loading,
    returnErrorResponse: true, // โจ ุฃุถู ูุฐุง ุงูุณุทุฑ
    action: () async {
      return await postData(Linkapi.some_endpoint, {...});
    },
  );

  if (response == null || response is! Map) {
    mySnackbar("ุฎุทุฃ", "ูุดู ุชุญููู ุงูุจูุงูุงุช");
    dataList.clear();
    return;
  }

  if (response['stat'] == 'ok') {
    // ูุนุงูุฌุฉ ุงููุฌุงุญ
  } else if (response['stat'] == 'error') { // โจ ุฃุถู ูุฐุง ุงูุดุฑุท
    // ูุนุงูุฌุฉ ุฃุฎุทุงุก ุงูุฎุงุฏู/ุงูุดุจูุฉ
    mySnackbar("ุฎุทุฃ", response['msg'] ?? "ุญุฏุซ ุฎุทุฃ");
  } else if (response['stat'] == 'no') {
    // ูุง ุชูุฌุฏ ุจูุงูุงุช
  }
}
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุงูุชูุงูู ูุน ุงูููุฏ ุงููุฏูู**: 
   - ุฌููุน ุงูุงุณุชุฏุนุงุกุงุช ุงููุฏููุฉ ูู `handleRequest` ุณุชุณุชูุฑ ูู ุงูุนูู ุจุฏูู ุชุบููุฑ
   - ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ูู `returnErrorResponse` ูู `false`

2. **ูุชู ุชุณุชุฎุฏู ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ**:
   - โ ูู ุงูุตูุญุงุช ุงูุญุณุงุณุฉ (ุชุณุฌูู ุฏุฎููุ ุฏูุนุ ุฅูุฎ)
   - โ ุนูุฏ ุงูุญุงุฌุฉ ููุนุงูุฌุฉ ุฏูููุฉ ููุฃุฎุทุงุก
   - โ ูู ุงูุชูุงุฑูุฑ ูุงูุนูููุงุช ุงููููุฉ
   - โ ููุณ ุถุฑูุฑูุงู ูู ุงูุนูููุงุช ุงูุจุณูุทุฉ

3. **ุงูุฃุฏุงุก**:
   - ูุง ููุฌุฏ ุชุฃุซูุฑ ุนูู ุงูุฃุฏุงุก
   - ููุณ ุงูุณุฑุนุฉ ูุงูููุงุกุฉ

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ:
- [x] ุชุณุฌูู ุฏุฎูู ุจุฏูู ุฅูุชุฑูุช
- [x] ุชุณุฌูู ุฏุฎูู ูุน timeout
- [x] ุชุณุฌูู ุฏุฎูู ูุน ุจูุงูุงุช ุฎุงุทุฆุฉ
- [x] ุชุณุฌูู ุฏุฎูู ูุงุฌุญ
- [ ] ุชุทุจูู ุนูู ุตูุญุงุช ุงูุชูุงุฑูุฑ
- [ ] ุชุทุจูู ุนูู ุตูุญุงุช ุงูุญุถูุฑ

---

## ๐ ุงููุฑุงุฌุน

- `lib/constants/function.dart` - ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ
- `lib/controller/loginController.dart` - ูุซุงู ุงูุชุทุจูู
- `docs/handleRequest_usage.md` - ุฏููู ุงูุงุณุชุฎุฏุงู ุงููุงูู

---

## ๐จโ๐ป ุงููุทูุฑ
ุชู ุงูุชุทููุฑ ุจูุงุณุทุฉ: Cascade AI
ุงูุชุงุฑูุฎ: 25 ุฃูุชูุจุฑ 2025

---

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

### ูุฎุทุท ููุง:
- [ ] ุฅุถุงูุฉ retry mechanism ููุทูุจุงุช ุงููุงุดูุฉ
- [ ] ุฅุถุงูุฉ caching ููุจูุงูุงุช
- [ ] ุชุญุณูู ุฑุณุงุฆู ุงูุฎุทุฃ ุจูุงุกู ุนูู ุงูุณูุงู
- [ ] ุฅุถุงูุฉ analytics ูุชุชุจุน ุงูุฃุฎุทุงุก

---

## ๐ก ูุตุงุฆุญ ูููุทูุฑูู

1. **ุงุณุชุฎุฏู ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ ุชุฏุฑูุฌูุงู**
   - ุงุจุฏุฃ ุจุงูุตูุญุงุช ุงููููุฉ
   - ุงุฎุชุจุฑ ูู ุตูุญุฉ ุจุนุฏ ุงูุชุนุฏูู

2. **ุงูุชุจ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ**
   - ุงุณุชุฎุฏู ูุบุฉ ุจุณูุทุฉ
   - ูุฏู ุญููู ููููุฉ ูููุณุชุฎุฏู

3. **ุฑุงุฌุน ุงูููุฏ ุงููุฏูู**
   - ุงุจุญุซ ุนู ุฃูุงูู ุชุญุชุงุฌ ุชุญุณูู
   - ุญุฏูุซ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุชุฏุฑูุฌูุงู

4. **ูุซูู ุงูุชุบููุฑุงุช**
   - ุฃุถู ุชุนูููุงุช ูู ุงูููุฏ
   - ุญุฏูุซ ูุฐุง ุงูููู ุนูุฏ ุฅุถุงูุฉ ููุฒุงุช ุฌุฏูุฏุฉ
